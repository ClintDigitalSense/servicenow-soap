<?xml version="1.0" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>ServiceNow::SOAP</title>
<link rel="stylesheet" href="http://st.pimg.net/tucs/style.css?3" type="text/css" />
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<link rev="made" href="mailto:" />
</head>

<body>



<ul id="index">
  <li><a href="#NAME">NAME</a></li>
  <li><a href="#SYNOPSIS">SYNOPSIS</a></li>
  <li><a href="#EXAMPLES">EXAMPLES</a></li>
  <li><a href="#DESCRIPTION">DESCRIPTION</a></li>
  <li><a href="#SESSION-METHODS">SESSION METHODS</a>
    <ul>
      <li><a href="#new">new</a>
        <ul>
          <li><a href="#Description">Description</a></li>
          <li><a href="#Syntax">Syntax</a></li>
          <li><a href="#Examples">Examples</a></li>
        </ul>
      </li>
      <li><a href="#connect">connect</a>
        <ul>
          <li><a href="#Description1">Description</a></li>
          <li><a href="#Syntax1">Syntax</a></li>
        </ul>
      </li>
      <li><a href="#table">table</a>
        <ul>
          <li><a href="#Description2">Description</a></li>
          <li><a href="#Syntax2">Syntax</a></li>
          <li><a href="#Example">Example</a></li>
        </ul>
      </li>
      <li><a href="#saveSession">saveSession</a>
        <ul>
          <li><a href="#Description3">Description</a></li>
          <li><a href="#Syntax3">Syntax</a></li>
        </ul>
      </li>
      <li><a href="#loadSession">loadSession</a>
        <ul>
          <li><a href="#Description4">Description</a></li>
          <li><a href="#Syntax4">Syntax</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#TABLE-METHODS">TABLE METHODS</a>
    <ul>
      <li><a href="#get">get</a>
        <ul>
          <li><a href="#Description5">Description</a></li>
          <li><a href="#Syntax5">Syntax</a></li>
          <li><a href="#Example1">Example</a></li>
        </ul>
      </li>
      <li><a href="#getKeys">getKeys</a>
        <ul>
          <li><a href="#Description6">Description</a></li>
          <li><a href="#Syntax6">Syntax</a></li>
          <li><a href="#Examples1">Examples</a></li>
        </ul>
      </li>
      <li><a href="#getRecords">getRecords</a>
        <ul>
          <li><a href="#Description7">Description</a></li>
          <li><a href="#Syntax7">Syntax</a></li>
          <li><a href="#Example2">Example</a></li>
        </ul>
      </li>
      <li><a href="#getRecord">getRecord</a>
        <ul>
          <li><a href="#Description8">Description</a></li>
          <li><a href="#Syntax8">Syntax</a></li>
          <li><a href="#Example3">Example</a></li>
        </ul>
      </li>
      <li><a href="#count">count</a>
        <ul>
          <li><a href="#Description9">Description</a></li>
          <li><a href="#Syntax9">Syntax</a></li>
          <li><a href="#Examples2">Examples</a></li>
        </ul>
      </li>
      <li><a href="#insert">insert</a>
        <ul>
          <li><a href="#Description10">Description</a></li>
          <li><a href="#Syntax10">Syntax</a></li>
          <li><a href="#Examples3">Examples</a></li>
        </ul>
      </li>
      <li><a href="#update">update</a>
        <ul>
          <li><a href="#Description11">Description</a></li>
          <li><a href="#Syntax11">Syntax</a></li>
          <li><a href="#Examples4">Examples</a></li>
        </ul>
      </li>
      <li><a href="#deleteRecord">deleteRecord</a>
        <ul>
          <li><a href="#Description12">Description</a></li>
          <li><a href="#Syntax12">Syntax</a></li>
        </ul>
      </li>
      <li><a href="#query">query</a>
        <ul>
          <li><a href="#Description13">Description</a></li>
          <li><a href="#Syntax13">Syntax</a></li>
          <li><a href="#Example4">Example</a></li>
        </ul>
      </li>
      <li><a href="#asQuery">asQuery</a>
        <ul>
          <li><a href="#Description14">Description</a></li>
          <li><a href="#Syntax14">Syntax</a></li>
          <li><a href="#Example5">Example</a></li>
        </ul>
      </li>
      <li><a href="#attachFile">attachFile</a>
        <ul>
          <li><a href="#Description15">Description</a></li>
          <li><a href="#Syntax15">Syntax</a></li>
          <li><a href="#Example6">Example</a></li>
        </ul>
      </li>
      <li><a href="#getVariables">getVariables</a>
        <ul>
          <li><a href="#Description16">Description</a></li>
          <li><a href="#Syntax16">Syntax</a></li>
          <li><a href="#Example7">Example</a></li>
        </ul>
      </li>
      <li><a href="#setDV">setDV</a>
        <ul>
          <li><a href="#Description17">Description</a></li>
          <li><a href="#Syntax17">Syntax</a></li>
          <li><a href="#Examples5">Examples</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#setTimeout">setTimeout</a>
    <ul>
      <li><a href="#Description18">Description</a></li>
      <li><a href="#syntax">syntax</a></li>
      <li><a href="#getFields">getFields</a>
        <ul>
          <li><a href="#Description19">Description</a></li>
          <li><a href="#Syntax18">Syntax</a></li>
          <li><a href="#Example8">Example</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#QUERY-METHODS">QUERY METHODS</a>
    <ul>
      <li><a href="#Description20">Description</a></li>
      <li><a href="#Example9">Example</a></li>
      <li><a href="#fetch">fetch</a>
        <ul>
          <li><a href="#Description21">Description</a></li>
          <li><a href="#Syntax19">Syntax</a></li>
          <li><a href="#Example10">Example</a></li>
        </ul>
      </li>
      <li><a href="#fetchAll">fetchAll</a>
        <ul>
          <li><a href="#Description22">Description</a></li>
          <li><a href="#Syntax20">Syntax</a></li>
          <li><a href="#Example11">Example</a></li>
        </ul>
      </li>
      <li><a href="#setColumns">setColumns</a>
        <ul>
          <li><a href="#Description23">Description</a></li>
          <li><a href="#Syntax21">Syntax</a></li>
          <li><a href="#Example12">Example</a></li>
        </ul>
      </li>
    </ul>
  </li>
  <li><a href="#AUTHOR">AUTHOR</a></li>
  <li><a href="#ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS</a></li>
  <li><a href="#LICENSE">LICENSE</a></li>
  <li><a href="#POD-ERRORS">POD ERRORS</a></li>
</ul>

<h1 id="NAME">NAME</h1>

<p>ServiceNow::SOAP - Second Generation SOAP API for ServiceNow</p>

<h1 id="SYNOPSIS">SYNOPSIS</h1>

<pre><code><code>    <span class="comment"># return a reference to a session object</span>
    <span class="keyword">my</span> <span class="variable">$sn</span> <span class="operator">=</span> <span class="variable">ServiceNow</span><span class="operator">(</span><span class="variable">$instancename</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">);</span>
    
    <span class="comment"># return a reference to a table object</span>
    <span class="keyword">my</span> <span class="variable">$table</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="variable">$tablename</span><span class="operator">);</span>
    
    <span class="comment"># count records</span>
    <span class="keyword">my</span> <span class="variable">$count</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">count</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    
    <span class="comment"># return a list of sys_ids</span>
    <span class="keyword">my</span> <span class="variable">@keys</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getKeys</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    
    <span class="comment"># return a single record as a hash</span>
    <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">get</span><span class="operator">(</span><span class="string">sys_id</span> <span class="operator">=&gt;</span> <span class="variable">$sys_id</span><span class="operator">);</span>
    
    <span class="comment"># return a set of records as an array of hashes</span>
    <span class="keyword">my</span> <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getRecords</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    
    <span class="comment"># call getKeys and return a query object</span>
    <span class="keyword">my</span> <span class="variable">$qry</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">query</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    
    <span class="comment"># fetch the next chunk of records</span>
    <span class="keyword">my</span> <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$qry</span><span class="operator">-&gt;</span><span class="variable">fetch</span><span class="operator">(</span><span class="variable">$numrecs</span><span class="operator">);</span>
    
    <span class="comment"># retrieve a record based on a unique key other than sys_id</span>
    <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getRecord</span><span class="operator">(</span><span class="variable">$name</span> <span class="operator">=&gt;</span> <span class="variable">$value</span><span class="operator">);</span>
    
    <span class="comment"># insert a record</span>
    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">insert</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    
    <span class="comment"># update a record</span>
    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">update</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
</code></code></pre>

<h1 id="EXAMPLES">EXAMPLES</h1>

<pre><code><code>    <span class="keyword">use</span> <span class="variable">ServiceNow::SOAP</span><span class="operator">;</span>
    
    <span class="keyword">my</span> <span class="variable">$sn</span> <span class="operator">=</span> <span class="variable">ServiceNow</span><span class="operator">(</span><span class="string">"mycompany"</span><span class="operator">,</span> <span class="string">"soap.perl"</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">);</span>
    
    <span class="keyword">my</span> <span class="variable">$computer_tbl</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"cmdb_ci_computer"</span><span class="operator">);</span>
    
    <span class="comment"># retrieve a small number of records     </span>
    <span class="keyword">my</span> <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$computer_tbl</span><span class="operator">-&gt;</span><span class="variable">getRecords</span><span class="operator">(</span>
        <span class="string">"location.name"</span> <span class="operator">=&gt;</span> <span class="string">"London"</span><span class="operator">,</span> 
        <span class="string">"operational_status"</span> <span class="operator">=&gt;</span> <span class="string">"1"</span><span class="operator">,</span>
        <span class="string">__order_by</span> <span class="operator">=&gt;</span> <span class="string">"name"</span><span class="operator">,</span> 
        <span class="string">__limit</span> <span class="operator">=&gt;</span> <span class="number">500</span><span class="operator">);</span>
    <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">(</span><span class="variable">@recs</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="keyword">print</span> <span class="variable">$rec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">name</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
    <span class="operator">}</span>
    
    <span class="comment"># count records</span>
    <span class="keyword">my</span> <span class="variable">$count</span> <span class="operator">=</span> <span class="variable">$computer_tbl</span><span class="operator">-&gt;</span><span class="variable">count</span><span class="operator">(</span>
        <span class="string">"location.name"</span> <span class="operator">=&gt;</span> <span class="string">"London"</span><span class="operator">,</span> 
        <span class="string">"operational_status"</span> <span class="operator">=&gt;</span> <span class="string">"1"</span><span class="operator">);</span>
    
    <span class="comment"># retrieve records in chunks </span>
    <span class="keyword">my</span> <span class="variable">$qry</span> <span class="operator">=</span> <span class="variable">$computer_tbl</span><span class="operator">-&gt;</span><span class="variable">query</span><span class="operator">(</span>
        <span class="string">"location.name"</span> <span class="operator">=&gt;</span> <span class="string">"London"</span><span class="operator">,</span> 
        <span class="string">"operational_status"</span> <span class="operator">=&gt;</span> <span class="string">"1"</span><span class="operator">,</span>
        <span class="string">__order_by</span> <span class="operator">=&gt;</span> <span class="string">"name"</span><span class="operator">);</span>
    <span class="keyword">while</span> <span class="operator">(</span><span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$qry</span><span class="operator">-&gt;</span><span class="variable">fetch</span><span class="operator">(</span><span class="number">200</span><span class="operator">))</span> <span class="operator">{</span>
        <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">(</span><span class="variable">@recs</span><span class="operator">)</span> <span class="operator">{</span>
            <span class="keyword">print</span> <span class="variable">$rec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">name</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
        <span class="operator">}</span>
    <span class="operator">}</span>
    
    <span class="comment"># retrieve all the records in a large table </span>
    <span class="keyword">my</span> <span class="variable">$recs</span> <span class="operator">=</span> <span class="variable">$computer_tbl</span><span class="operator">-&gt;</span><span class="variable">query</span><span class="operator">()-&gt;</span><span class="variable">fetchAll</span><span class="operator">();</span>
    
    <span class="comment"># insert a record</span>
    <span class="keyword">my</span> <span class="variable">$incident_tbl</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"incident"</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$sys_id</span> <span class="operator">=</span> <span class="variable">$incident_tbl</span><span class="operator">-&gt;</span><span class="variable">insert</span><span class="operator">(</span>
        <span class="string">assignment_group</span> <span class="operator">=&gt;</span> <span class="string">"Network Support"</span><span class="operator">,</span>
        <span class="string">short_description</span> <span class="operator">=&gt;</span> <span class="variable">$short_description</span><span class="operator">,</span>
        <span class="string">impact</span> <span class="operator">=&gt;</span> <span class="number">2</span><span class="operator">);</span>
    
    <span class="comment"># retrieve a single record based on sys_id</span>
    <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$incident_tbl</span><span class="operator">-&gt;</span><span class="variable">get</span><span class="operator">(</span><span class="string">sys_id</span> <span class="operator">=&gt;</span> <span class="variable">$sys_id</span><span class="operator">);</span>
    <span class="keyword">print</span> <span class="string">"number="</span><span class="operator">,</span> <span class="variable">$rec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">number</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
    
    <span class="comment"># retrieve a single record based on number</span>
    <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$incident_tbl</span><span class="operator">-&gt;</span><span class="variable">getRecord</span><span class="operator">(</span><span class="string">number</span> <span class="operator">=&gt;</span> <span class="variable">$number</span><span class="operator">);</span>
    <span class="keyword">print</span> <span class="string">"sys_id="</span><span class="operator">,</span> <span class="variable">$rec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sys_id</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
    
    <span class="comment"># update a record</span>
    <span class="variable">$incident_tbl</span><span class="operator">-&gt;</span><span class="variable">update</span><span class="operator">(</span>
        <span class="string">sys_id</span> <span class="operator">=&gt;</span> <span class="variable">$sys_id</span><span class="operator">,</span>
        <span class="string">assigned_to</span> <span class="operator">=&gt;</span> <span class="string">"Fred Luddy"</span><span class="operator">,</span>
        <span class="string">incident_state</span> <span class="operator">=&gt;</span> <span class="number">2</span><span class="operator">);</span>
</code></code></pre>

<h1 id="DESCRIPTION">DESCRIPTION</h1>

<p>This module is a second generation Perl API for ServiceNow built on top of SOAP::Lite.</p>

<p>Features of this module include:</p>

<ul>

<li><p>Simplified API which closely mirrors ServiceNow&#39;s <a href="http://wiki.servicenow.com/index.php?title=SOAP_Direct_Web_Service_API">Direct Web Services API</a>.</p>

</li>
<li><p>Efficient and easy to use methods for reading large tables. Please see to <a href="#QUERY-METHODS">&quot;QUERY METHODS&quot;</a> below. These methods overcome ServiceNow&#39;s built-in limitation of 250 records per SOAP Web Services call, and adhere to ServiceNow&#39;s <a href="http://wiki.servicenow.com/index.php?title=Web_Services_Integrations_Best_Practices#Queries">best practice recommendations</a> for querying data through Web Services.</p>

</li>
<li><p>Specialized functions such as <a href="#attachFile">&quot;attachFile&quot;</a> and <a href="#getVariables">&quot;getVariables&quot;</a>.</p>

</li>
</ul>

<h1 id="SESSION-METHODS">SESSION METHODS</h1>

<h2 id="new">new</h2>

<h3 id="Description">Description</h3>

<p>Used to obtain a reference to an Session object. The Session object essentially holds the URL and connection credentials for your ServiceNow instance. The first argument is the URL or instance name. The second argument is the user name. The third argument is the password.</p>

<p>The fourth (optional) argument to this method is an integer trace level which can be helpful for debugging. Sometimes, when you are developing a new script, it seems to hang at a certain point, and you just want to know what it is doing. Set the trace level to 1 to enable tracing messages for SOAP calls. Set the trace level to 2 to dump the complete XML of all SOAP results.</p>

<h3 id="Syntax">Syntax</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$sn</span> <span class="operator">=</span> <span class="variable">ServiceNow</span><span class="operator">(</span><span class="variable">$instancename</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$sn</span> <span class="operator">=</span> <span class="variable">ServiceNow</span><span class="operator">(</span><span class="variable">$instanceurl</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$sn</span> <span class="operator">=</span> <span class="variable">ServiceNow</span><span class="operator">(</span><span class="variable">$instancename</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">,</span> <span class="variable">$tracelevel</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Examples">Examples</h3>

<p>The following two statements are equivalent.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$sn</span> <span class="operator">=</span> <span class="variable">ServiceNow</span><span class="operator">(</span><span class="string">"https://mycompanydev.service-now.com"</span><span class="operator">,</span> <span class="string">"soap.perl"</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$sn</span> <span class="operator">=</span> <span class="variable">ServiceNow</span><span class="operator">(</span><span class="string">"mycompanydev"</span><span class="operator">,</span> <span class="string">"soap.perl"</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">);</span>
</code></code></pre>

<p>Tracing of Web Services calls can be enabled by passing in a fourth parameter.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$sn</span> <span class="operator">=</span> <span class="variable">ServiceNow</span><span class="operator">(</span><span class="string">"mycompanydev"</span><span class="operator">,</span> <span class="string">"soap.perl"</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">,</span> <span class="number">1</span><span class="operator">);</span>
</code></code></pre>

<h2 id="connect">connect</h2>

<h3 id="Description1">Description</h3>

<p>Use of this function is optional, but sometimes you want to know up front whether your connection credentials are valid. This function tests them by attempting to get the user&#39;s profile from <code><code>sys_user</code></code> using <code><code>getRecords</code></code>, and trapping the error. If successful, the session object is returned. If unsuccessful, null is returned and the error message is in $@.</p>

<h3 id="Syntax1">Syntax</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$sn</span> <span class="operator">=</span> <span class="variable">ServiceNow</span><span class="operator">(</span><span class="variable">$instancename</span><span class="operator">,</span> <span class="variable">$username</span><span class="operator">,</span> <span class="variable">$password</span><span class="operator">)-&gt;</span><span class="variable">connect</span><span class="operator">()</span>
        <span class="keyword">or</span> <span class="keyword">die</span> <span class="string">"Unable to connect to </span><span class="variable">$instancename</span><span class="string">: $@"</span><span class="operator">;</span>
</code></code></pre>

<h2 id="table">table</h2>

<h3 id="Description2">Description</h3>

<p>Used to obtain a Table object. The Table object is subsequently used for <a href="#TABLE-METHODS">&quot;TABLE METHODS&quot;</a> described below.</p>

<h3 id="Syntax2">Syntax</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$table</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="variable">$tablename</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example">Example</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$computer_tbl</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"cmdb_ci_computer"</span><span class="operator">);</span>
</code></code></pre>

<h2 id="saveSession">saveSession</h2>

<h3 id="Description3">Description</h3>

<p>Saves the session information to a file. See <a href="#loadSession">&quot;loadSession&quot;</a>.</p>

<h3 id="Syntax3">Syntax</h3>

<pre><code><code>    <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">saveSession</span><span class="operator">(</span><span class="variable">$filename</span><span class="operator">);</span>
</code></code></pre>

<h2 id="loadSession">loadSession</h2>

<h3 id="Description4">Description</h3>

<p>Loads the session information from a file. This may be required if you are running the same perl script over and over (each time in a separate process) and you do not want to establish a separate ServiceNow session each time the script is run.</p>

<h3 id="Syntax4">Syntax</h3>

<pre><code><code>    <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">loadSession</span><span class="operator">(</span><span class="variable">$filename</span><span class="operator">);</span>
</code></code></pre>

<h1 id="TABLE-METHODS">TABLE METHODS</h1>

<p>Refer to <a href="#table">&quot;table&quot;</a> function above for instructions on obtaining a reference to a Table object.</p>

<h2 id="get">get</h2>

<h3 id="Description5">Description</h3>

<p>Retrieves a single record. The result is returned as a reference to a hash.</p>

<p>If no matching record is found then null is returned.</p>

<p>For additional information refer to the ServiceNow documentation on the <a href="http://wiki.servicenow.com/index.php?title=SOAP_Direct_Web_Service_API#get">&quot;get&quot; Direct SOAP API method</a>.</p>

<h3 id="Syntax5">Syntax</h3>

<pre><code><code>    <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">get</span><span class="operator">(</span><span class="string">sys_id</span> <span class="operator">=&gt;</span> <span class="variable">$sys_id</span><span class="operator">);</span>
    <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">get</span><span class="operator">(</span><span class="variable">$sys_id</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example1">Example</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">get</span><span class="operator">(</span><span class="variable">$sys_id</span><span class="operator">);</span>
    <span class="keyword">print</span> <span class="variable">$rec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">name</span><span class="operator">}</span><span class="operator">;</span>
</code></code></pre>

<h2 id="getKeys">getKeys</h2>

<h3 id="Description6">Description</h3>

<p>Returns a list of keys. Note that this method returns a list of keys, <b>NOT</b> a comma delimited list.</p>

<p>For additional information on available parameters refer to the ServiceNow documentation on the <a href="http://wiki.servicenow.com/index.php?title=SOAP_Direct_Web_Service_API#getKeys">&quot;getKeys&quot; Direct SOAP API method</a>.</p>

<h3 id="Syntax6">Syntax</h3>

<pre><code><code>    <span class="variable">@keys</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getKeys</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    <span class="variable">@keys</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getKeys</span><span class="operator">(</span><span class="variable">$encodedquery</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Examples1">Examples</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$cmdb_ci_computer</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"cmdb_ci_computer"</span><span class="operator">);</span>
    
    <span class="keyword">my</span> <span class="variable">@keys</span> <span class="operator">=</span> <span class="variable">$cmdb_ci_computer</span><span class="operator">-&gt;</span><span class="variable">getKeys</span><span class="operator">(</span><span class="string">operational_status</span> <span class="operator">=&gt;</span> <span class="number">1</span><span class="operator">,</span> <span class="string">virtual</span> <span class="operator">=&gt;</span> <span class="string">"false"</span><span class="operator">);</span>
    <span class="comment"># or</span>
    <span class="keyword">my</span> <span class="variable">@keys</span> <span class="operator">=</span> <span class="variable">$cmdb_ci_computer</span><span class="operator">-&gt;</span><span class="variable">getKeys</span><span class="operator">(</span><span class="string">"operational_status=1^virtual=false"</span><span class="operator">);</span>
</code></code></pre>

<h2 id="getRecords">getRecords</h2>

<h3 id="Description7">Description</h3>

<p>Returns a list of records. Actually, it returns a list of hashes. You may pass this function either a single encoded query, or a list of name/value pairs.</p>

<p>For additional information on available parameters refer to the ServiceNow documentation on the <a href="http://wiki.servicenow.com/index.php?title=SOAP_Direct_Web_Service_API#getRecords">&quot;getRecords&quot; Direct SOAP API method</a>.</p>

<p><b>Important Note</b>: This method will return at most 250 records, unless you specify a <code><code>__limit</code></code> parameter as documented in the ServiceNow wiki under <a href="http://wiki.servicenow.com/index.php?title=Direct_Web_Services#Extended_Query_Parameters">Extended Query Parameters</a>.</p>

<h3 id="Syntax7">Syntax</h3>

<pre><code><code>    <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getRecords</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getRecords</span><span class="operator">(</span><span class="variable">$encodedquery</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example2">Example</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$sys_user_group</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sys_user_group"</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">@grps</span> <span class="operator">=</span> <span class="variable">$sys_user_group</span><span class="operator">-&gt;</span><span class="variable">getRecords</span><span class="operator">(</span>
        <span class="string">active</span> <span class="operator">=&gt;</span> <span class="variable">true</span><span class="operator">,</span> <span class="string">__limit</span> <span class="operator">=&gt;</span> <span class="number">500</span><span class="operator">,</span> <span class="string">__order_by</span> <span class="operator">=&gt;</span> <span class="string">"name"</span><span class="operator">);</span>
    <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$grp</span> <span class="operator">(</span><span class="variable">@grps</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="keyword">print</span> <span class="variable">$grp</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">name</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
    <span class="operator">}</span>
</code></code></pre>

<h2 id="getRecord">getRecord</h2>

<h3 id="Description8">Description</h3>

<p>Returns a single qualifying records. Returns null if there are no qualifying records. Dies if there are multiple qualifying records.</p>

<h3 id="Syntax8">Syntax</h3>

<pre><code><code>    <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getRecord</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getRecord</span><span class="operator">(</span><span class="variable">$encodedquery</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example3">Example</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$number</span> <span class="operator">=</span> <span class="string">"CHG12345"</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$chgRec</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"change_request"</span><span class="operator">)-&gt;</span><span class="variable">getRecord</span><span class="operator">(</span><span class="string">number</span> <span class="operator">=&gt;</span> <span class="variable">$number</span><span class="operator">);</span>
    <span class="keyword">if</span> <span class="operator">(</span><span class="variable">$chgRec</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="keyword">print</span> <span class="string">"Short description = "</span><span class="operator">,</span> <span class="variable">$chgRec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">short_description</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
    <span class="operator">}</span>
    <span class="keyword">else</span> <span class="operator">{</span>
        <span class="keyword">print</span> <span class="string">"</span><span class="variable">$number</span><span class="string"> not found\n"</span><span class="operator">;</span>
    <span class="operator">}</span>
</code></code></pre>

<p>The following two examples are equivalent.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getRecord</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    
    <span class="keyword">my</span> <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getRecords</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    <span class="keyword">die</span> <span class="string">"Too many records"</span> <span class="keyword">if</span> <span class="keyword">scalar</span><span class="operator">(</span><span class="variable">@recs</span><span class="operator">)</span> <span class="operator">&gt;</span> <span class="number">1</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">=</span> <span class="variable">$recs</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="operator">;</span>
</code></code></pre>

<h2 id="count">count</h2>

<h3 id="Description9">Description</h3>

<p>Counts the number of records in a table, or the number of records that match a set of parameters.</p>

<p>This method requres installation of the <a href="http://wiki.servicenow.com/index.php?title=SOAP_Direct_Web_Service_API#aggregate">Aggregate Web Service plugin</a>.</p>

<h3 id="Syntax9">Syntax</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$count</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">count</span><span class="operator">();</span>
    <span class="keyword">my</span> <span class="variable">$count</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">count</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$count</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">count</span><span class="operator">(</span><span class="variable">$encodedquery</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Examples2">Examples</h3>

<p>Count the total number of users:</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$count</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sys_user"</span><span class="operator">)-&gt;</span><span class="variable">count</span><span class="operator">();</span>
</code></code></pre>

<p>Count the number of active users:</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$count</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sys_user"</span><span class="operator">)-&gt;</span><span class="variable">count</span><span class="operator">(</span><span class="string">active</span> <span class="operator">=&gt;</span> <span class="variable">true</span><span class="operator">);</span>
</code></code></pre>

<h2 id="insert">insert</h2>

<h3 id="Description10">Description</h3>

<p>Inserts a record. In a scalar context, this function returns a sys_id only. In a list context, this function returns a list of name/value pairs.</p>

<p>For information on available parameters refer to the ServiceNow documentation on the <a href="http://wiki.servicenow.com/index.php?title=SOAP_Direct_Web_Service_API#insert">&quot;insert&quot; Direct SOAP API method</a>.</p>

<h3 id="Syntax10">Syntax</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$sys_id</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">insert</span><span class="operator">(</span><span class="variable">%values</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">%result</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">insert</span><span class="operator">(</span><span class="variable">%values</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Examples3">Examples</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$incident</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"incident"</span><span class="operator">);</span>
</code></code></pre>

<p>In a scalar context, the function returns a sys_id.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$sys_id</span> <span class="operator">=</span> <span class="variable">$incident</span><span class="operator">-&gt;</span><span class="variable">insert</span><span class="operator">(</span>
        <span class="string">short_description</span> <span class="operator">=&gt;</span> <span class="variable">$short_description</span><span class="operator">,</span>
        <span class="string">assignment_group</span> <span class="operator">=&gt;</span> <span class="string">"Network Support"</span><span class="operator">,</span>
        <span class="string">impact</span> <span class="operator">=&gt;</span> <span class="number">3</span><span class="operator">);</span>
    <span class="keyword">print</span> <span class="string">"sys_id="</span><span class="operator">,</span> <span class="variable">$sys_id</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
</code></code></pre>

<p>In a list context, the function returns a list of name/value pairs.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">%result</span> <span class="operator">=</span> <span class="variable">$incident</span><span class="operator">-&gt;</span><span class="variable">insert</span><span class="operator">(</span>
        <span class="string">short_description</span> <span class="operator">=&gt;</span> <span class="variable">$short_description</span><span class="operator">,</span>
        <span class="string">assignment_group</span> <span class="operator">=&gt;</span> <span class="string">"Network Support"</span><span class="operator">,</span>
        <span class="string">impact</span> <span class="operator">=&gt;</span> <span class="number">3</span><span class="operator">);</span>
    <span class="keyword">print</span> <span class="string">"number="</span><span class="operator">,</span> <span class="variable">$result</span><span class="operator">{</span><span class="string">number</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
    <span class="keyword">print</span> <span class="string">"sys_id="</span><span class="operator">,</span> <span class="variable">$result</span><span class="operator">{</span><span class="string">sys_id</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
</code></code></pre>

<p>You can also call it this way:</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">%rec</span><span class="operator">;</span>
    <span class="variable">$rec</span><span class="operator">{</span><span class="string">short_description</span><span class="operator">}</span> <span class="operator">=</span> <span class="variable">$short_description</span><span class="operator">;</span>
    <span class="variable">$rec</span><span class="operator">{</span><span class="string">assignment_group</span><span class="operator">}</span> <span class="operator">=</span> <span class="string">"Network Support"</span><span class="operator">;</span>
    <span class="variable">$rec</span><span class="operator">{</span><span class="string">impact</span><span class="operator">}</span> <span class="operator">=</span> <span class="number">3</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$sys_id</span> <span class="operator">=</span> <span class="variable">$incident</span><span class="operator">-&gt;</span><span class="variable">insert</span><span class="operator">(</span><span class="variable">%rec</span><span class="operator">);</span>
</code></code></pre>

<p>Note that for reference fields (e.g. assignment_group, assigned_to) you may pass in either a sys_id or a display value.</p>

<h2 id="update">update</h2>

<h3 id="Description11">Description</h3>

<p>Updates a record. For information on available parameters refer to the ServiceNow documentation on the <a href="http://wiki.servicenow.com/index.php?title=SOAP_Direct_Web_Service_API#update">&quot;update&quot; Direct SOAP API method</a>.</p>

<h3 id="Syntax11">Syntax</h3>

<pre><code><code>    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">update</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">update</span><span class="operator">(</span><span class="variable">$sys_id</span><span class="operator">,</span> <span class="variable">%parameters</span><span class="operator">);</span>
</code></code></pre>

<p>Note: If the first syntax is used, then the <code><code>sys_id</code></code> must be included among the parameters. If the second syntax is used, then the <code><code>sys_id</code></code> must be the first parameter.</p>

<p>For reference fields (e.g. assignment_group, assigned_to) you may pass in either a sys_id or a display value.</p>

<h3 id="Examples4">Examples</h3>

<p>The following three examples are equivalent.</p>

<pre><code><code>    <span class="variable">$incident</span><span class="operator">-&gt;</span><span class="variable">update</span><span class="operator">(</span>
        <span class="string">sys_id</span> <span class="operator">=&gt;</span> <span class="variable">$sys_id</span><span class="operator">,</span> 
        <span class="string">assigned_to</span> <span class="operator">=&gt;</span> <span class="string">"5137153cc611227c000bbd1bd8cd2005"</span><span class="operator">,</span>
        <span class="string">incient_state</span> <span class="operator">=&gt;</span> <span class="number">2</span><span class="operator">);</span>
        
    <span class="variable">$incident</span><span class="operator">-&gt;</span><span class="variable">update</span><span class="operator">(</span>
        <span class="string">sys_id</span> <span class="operator">=&gt;</span> <span class="variable">$sys_id</span><span class="operator">,</span> 
        <span class="string">assigned_to</span> <span class="operator">=&gt;</span> <span class="string">"Fred Luddy"</span><span class="operator">,</span> 
        <span class="string">incident_state</span> <span class="operator">=&gt;</span> <span class="number">2</span><span class="operator">);</span>
    
    <span class="variable">$incident</span><span class="operator">-&gt;</span><span class="variable">update</span><span class="operator">(</span><span class="variable">$sys_id</span><span class="operator">,</span> 
        <span class="string">assigned_to</span> <span class="operator">=&gt;</span> <span class="string">"Fred Luddy"</span><span class="operator">,</span> 
        <span class="string">incident_state</span> <span class="operator">=&gt;</span> <span class="number">2</span><span class="operator">);</span>
</code></code></pre>

<h2 id="deleteRecord">deleteRecord</h2>

<h3 id="Description12">Description</h3>

<p>Deletes a record. For information on available parameters refer to the ServiceNow documentation on the <a href="http://wiki.servicenow.com/index.php?title=SOAP_Direct_Web_Service_API#deleteRecord">&quot;deleteRecord&quot; Direct SOAP API method</a>.</p>

<h3 id="Syntax12">Syntax</h3>

<pre><code><code>    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">deleteRecord</span><span class="operator">(</span><span class="string">sys_id</span> <span class="operator">=&gt;</span> <span class="variable">$sys_id</span><span class="operator">);</span>
    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">deleteRecord</span><span class="operator">(</span><span class="variable">$sys_id</span><span class="operator">);</span>
</code></code></pre>

<h2 id="query">query</h2>

<h3 id="Description13">Description</h3>

<p>This function creates a new Query object by calling <a href="#getKeys">&quot;getKeys&quot;</a>.</p>

<h3 id="Syntax13">Syntax</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$query</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">query</span><span class="operator">(</span><span class="variable">%parameters</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$query</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">query</span><span class="operator">(</span><span class="variable">$encodedquery</span><span class="operator">};</span>
</code></code></pre>

<h3 id="Example4">Example</h3>

<p>The following example builds a list of all Incidents created between 1/1/2014 and 2/1/2014 sorted by creation date/time. The <code><code>fetchAll</code></code> method fetches chunks of records until all records have been retrieved.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$filter</span> <span class="operator">=</span> <span class="string">"sys_created_on&gt;=2014-01-01^sys_created_on&lt;2014-02-01"</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">$qry</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"incident"</span><span class="operator">)-&gt;</span><span class="variable">query</span><span class="operator">(</span>
        <span class="string">__encoded_query</span> <span class="operator">=&gt;</span> <span class="variable">$filter</span><span class="operator">,</span>
        <span class="string">__order_by</span> <span class="operator">=&gt;</span> <span class="string">"sys_created_on);
    my </span><span class="variable">@recs</span><span class="string"> = </span><span class="variable">$qry</span><span class="string">-&gt;fetchAll();
    </span>
</code></code></pre>

<h2 id="asQuery">asQuery</h2>

<h3 id="Description14">Description</h3>

<p>This function creates a new Query object from a list of keys. It does not make any Web Services calls. It simply makes a copy of the list. Each item in the list must be a sys_id for the respective table.</p>

<h3 id="Syntax14">Syntax</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$query</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">asQuery</span><span class="operator">(</span><span class="variable">@keys</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example5">Example</h3>

<p>In this example, we assume that <code><code>@incRecs</code></code> contains an array of <code><code>incident</code></code> records from a previous query. We need an array of <code><code>sys_user_group</code></code> records for all referenced assignment groups. We use <code><code>map</code></code> to extract a list of assignment group keys from the <code><code>@incRecs</code></code>; <code><code>grep</code></code> to discard the blanks; and <code><code>uniq</code></code> to discard the duplicates. <code><code>@grpKeys</code></code> contains the list of <code><code>sys_user_group</code></code> keys. This array is then used to construct a new Query using <a href="#asQuery">&quot;asQuery&quot;</a> and <a href="#fetchAll">&quot;fetchAll&quot;</a> is used to retrieve the records.</p>

<pre><code><code>    <span class="keyword">use</span> <span class="variable">List::MoreUtils</span> <span class="string">qw(uniq)</span><span class="operator">;</span>
    
    <span class="keyword">my</span> <span class="variable">@grpKeys</span> <span class="operator">=</span> <span class="variable">uniq</span> <span class="keyword">grep</span> <span class="operator">{</span> <span class="operator">!</span><span class="regex">/^$/</span> <span class="operator">}</span> <span class="keyword">map</span> <span class="operator">{</span> <span class="variable">$_</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">assignment_group</span><span class="operator">}</span> <span class="operator">}</span> <span class="variable">@incRecs</span><span class="operator">;</span>
    <span class="keyword">my</span> <span class="variable">@grpRecs</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sys_user_group"</span><span class="operator">)-&gt;</span><span class="variable">asQuery</span><span class="operator">(</span><span class="variable">@grpKeys</span><span class="operator">)-&gt;</span><span class="variable">fetchAll</span><span class="operator">();</span>
        
</code></code></pre>

<h2 id="attachFile">attachFile</h2>

<h3 id="Description15">Description</h3>

<p>If you are using Perl to create incident tickets, then you may have a requirement to attach files to those tickets.</p>

<p>This function implements the <a href="http://wiki.servicenow.com/index.php?title=AttachmentCreator_SOAP_Web_Service">attachment creator API</a>. The function requires insert permissions on the <code><code>ecc_queue</code></code> table.</p>

<p>You will need to specify a MIME type. If no type is specified, this function will use a default type of &quot;text/plain&quot; For a list of MIME types, refer to <a href="http://en.wikipedia.org/wiki/Internet_media_type">http://en.wikipedia.org/wiki/Internet_media_type</a>.</p>

<p>When you attach a file to a ServiceNow record, you can also specify an attachment name which is different from the actual file name. If no attachment name is specified, this function will assume that the attachment name is the same as the file name.</p>

<p>This function will die if the file cannot be read.</p>

<h3 id="Syntax15">Syntax</h3>

<pre><code><code>    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">attachFile</span><span class="operator">(</span><span class="variable">$sys_id</span><span class="operator">,</span> <span class="variable">$filename</span><span class="operator">,</span> <span class="variable">$mime_type</span><span class="operator">,</span> <span class="variable">$attachment_name</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example6">Example</h3>

<pre><code><code>    <span class="variable">$incident</span><span class="operator">-&gt;</span><span class="variable">attachFile</span><span class="operator">(</span><span class="variable">$sys_id</span><span class="operator">,</span> <span class="string">"screenshot.png"</span><span class="operator">,</span> <span class="string">"image/png"</span><span class="operator">);</span>
</code></code></pre>

<h2 id="getVariables">getVariables</h2>

<h3 id="Description16">Description</h3>

<p>This function returns a list of hashes of the variables attached to a Requested Item (RITM).</p>

<p><b>Note</b>: This function currently works only for the <code><code>sc_req_item</code></code> table.</p>

<p>Each hash contains the following four fields:</p>

<ul>

<li><p>name - Name of the variable.</p>

</li>
<li><p>question - The question text.</p>

</li>
<li><p>reference - If the variable is a reference, then the name of the table. Otherwise blank.</p>

</li>
<li><p>value - Value of the question response. If the variable is a reference, then value will contain a sys_id.</p>

</li>
<li><p>order - Order (useful for sorting).</p>

</li>
</ul>

<h3 id="Syntax16">Syntax</h3>

<pre><code><code>    <span class="variable">$sc_req_item</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sc_req_item"</span><span class="operator">);</span>
    <span class="variable">@vars</span> <span class="operator">=</span> <span class="variable">$sc_req_item</span><span class="operator">-&gt;</span><span class="variable">getVariables</span><span class="operator">(</span><span class="variable">$sys_id</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example7">Example</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$sc_req_item</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sc_req_item"</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$ritmRec</span> <span class="operator">=</span> <span class="variable">$sc_req_item</span><span class="operator">-&gt;</span><span class="variable">getRecord</span><span class="operator">(</span><span class="string">number</span> <span class="operator">=&gt;</span> <span class="variable">$ritm_number</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">@vars</span> <span class="operator">=</span> <span class="variable">$sc_req_item</span><span class="operator">-&gt;</span><span class="variable">getVariables</span><span class="operator">(</span><span class="variable">$ritmRec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">sys_id</span><span class="operator">}</span><span class="operator">);</span>
    <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$var</span> <span class="operator">(</span><span class="keyword">sort</span> <span class="operator">{</span> <span class="variable">$a</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">order</span><span class="operator">}</span> <span class="operator">&lt;=&gt;</span> <span class="variable">$b</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">order</span><span class="operator">}</span> <span class="operator">}</span> <span class="variable">@vars</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="keyword">print</span> <span class="string">"</span><span class="variable">$var</span><span class="string">-&gt;{name} = </span><span class="variable">$var</span><span class="string">-&gt;{value}\n"</span><span class="operator">;</span>
    <span class="operator">}</span>
</code></code></pre>

<h2 id="setDV">setDV</h2>

<h3 id="Description17">Description</h3>

<p>Used to enable (or disable) display values in queries. All subsequent calls to <a href="#get">&quot;get&quot;</a>, <a href="#getRecords">&quot;getRecords&quot;</a> or <a href="#getRecord">&quot;getRecord&quot;</a> for this table will be affected. This function returns the modified Table object.</p>

<p>For additional information regarding display values refer to the ServiceNow documentation on <a href="http://wiki.servicenow.com/index.php?title=Direct_Web_Services#Return_Display_Value_for_Reference_Variables">&quot;Return Display Value for Reference Variables&quot;</a></p>

<h3 id="Syntax17">Syntax</h3>

<pre><code><code>    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">setDV</span><span class="operator">(</span><span class="string">"true"</span><span class="operator">);</span>
    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">setDV</span><span class="operator">(</span><span class="string">"all"</span><span class="operator">);</span>
    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">setDv</span><span class="operator">(</span><span class="string">""</span><span class="operator">);</span>  <span class="comment"># restore default setting</span>
</code></code></pre>

<h3 id="Examples5">Examples</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$sys_user_group</span> <span class="operator">=</span> <span class="variable">$session</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sys_user_group"</span><span class="operator">)-&gt;</span><span class="variable">setDV</span><span class="operator">(</span><span class="string">"true"</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$grp</span> <span class="operator">=</span> <span class="variable">$sys_user_group</span><span class="operator">-&gt;</span><span class="variable">getRecord</span><span class="operator">(</span><span class="string">name</span> <span class="operator">=&gt;</span> <span class="string">"Network Support"</span><span class="operator">);</span>
    <span class="keyword">print</span> <span class="string">"manager="</span><span class="operator">,</span> <span class="variable">$grp</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">manager</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
    
    <span class="keyword">my</span> <span class="variable">$sys_user_group</span> <span class="operator">=</span> <span class="variable">$session</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sys_user_group"</span><span class="operator">)-&gt;</span><span class="variable">setDV</span><span class="operator">(</span><span class="string">"all"</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$grp</span> <span class="operator">=</span> <span class="variable">$sys_user_group</span><span class="operator">-&gt;</span><span class="variable">getRecord</span><span class="operator">(</span><span class="string">name</span> <span class="operator">=&gt;</span> <span class="string">"Network Support"</span><span class="operator">);</span>
    <span class="keyword">print</span> <span class="string">"manager="</span><span class="operator">,</span> <span class="variable">$grp</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">dv_manager</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
</code></code></pre>

<h1 id="setTimeout">setTimeout</h1>

<h2 id="Description18">Description</h2>

<p>Set the value of the SOAP Web Services client HTTP timeout. In addition, you may need to increase the ServiceNow system property <code><code>glide.soap.request_processing_timeout</code></code>.</p>

<h2 id="syntax">syntax</h2>

<pre><code><code>    <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">setTimeout</span><span class="operator">(</span><span class="variable">$seconds</span><span class="operator">);</span>
</code></code></pre>

<h2 id="getFields">getFields</h2>

<h3 id="Description19">Description</h3>

<p>Returns a hash of the fields in an sequence (complex type) from the WSDL. The hash key is the field name. The hash value is the field type.</p>

<h3 id="Syntax18">Syntax</h3>

<pre><code><code>    <span class="variable">%fields</span> <span class="operator">=</span> <span class="variable">$table</span><span class="operator">-&gt;</span><span class="variable">getFields</span><span class="operator">(</span><span class="variable">$type</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example8">Example</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">%fields</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sys_user_group"</span><span class="operator">)-&gt;</span><span class="variable">getFields</span><span class="operator">(</span><span class="string">"getRecordsResponse"</span><span class="operator">);</span>
    <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$name</span> <span class="operator">(</span><span class="keyword">sort</span> <span class="keyword">keys</span> <span class="variable">%fields</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="keyword">print</span> <span class="string">"name=</span><span class="variable">$name</span><span class="string"> type=</span><span class="variable">$fields</span><span class="string">{</span><span class="variable">$name</span><span class="string">}\n"</span><span class="operator">;</span>
    <span class="operator">}</span>
</code></code></pre>

<h1 id="QUERY-METHODS">QUERY METHODS</h1>

<h2 id="Description20">Description</h2>

<p>A Query object is essentially a list of keys (sys_ids) for a particular table, and a pointer to the current position in that list. Query objects and the related functions implement the ServiceNow best practice recommendations for using Web Services to query large tables as documented here: <a href="http://wiki.servicenow.com/index.php?title=Web_Services_Integrations_Best_Practices#Queries">http://wiki.servicenow.com/index.php?title=Web_Services_Integrations_Best_Practices#Queries</a>.</p>

<p>To construct a new Query object use the <a href="#query">&quot;query&quot;</a> or <a href="#asQuery">&quot;asQuery&quot;</a> Table Methods. <a href="#query">&quot;query&quot;</a> makes a Web Services call (<a href="#getKeys">&quot;getKeys&quot;</a>) to retrieve a list of keys. <a href="#asQuery">&quot;asQuery&quot;</a> simply converts an exsiting list of keys into a Query object.</p>

<p>Once constructed, the <a href="#fetch">fetch</a> and <a href="#fetchAll">fetchAll</a> functions can be used to get the actual records in chunks.</p>

<h2 id="Example9">Example</h2>

<p>This example illustrates the use of Query objects to traverse the <code><code>cmdb_rel_ci</code></code> table. The example involves two tables: <code><code>cmdb_ci</code></code> and <code><code>cmdb_rel_ci</code></code>.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$cmdb_ci</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"cmdb_ci"</span><span class="operator">);</span>
    <span class="keyword">my</span> <span class="variable">$cmdb_rel_ci</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"cmdb_rel_ci"</span><span class="operator">);</span>
</code></code></pre>

<p>We assume that <code><code>$parentKey</code></code> is the sys_id of a known configuration item. The object is to print a list of all other configuration items on which this item immediately depends. In otherwords, all items which are one level downstream.</p>

<p>First we query <code><code>cmdb_rel_ci</code></code> to retrieve a list of records for which this item is the parent. <code><code>@relData</code></code> is a list of <code><code>cmdb_rel_ci</code></code> records.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">@relData</span> <span class="operator">=</span> <span class="variable">$cmdb_rel_ci</span><span class="operator">-&gt;</span><span class="variable">query</span><span class="operator">(</span><span class="string">parent</span> <span class="operator">=&gt;</span> <span class="variable">$parentKey</span><span class="operator">)-&gt;</span><span class="variable">fetchAll</span><span class="operator">();</span>
</code></code></pre>

<p>Next we extract the <code><code>child</code></code> field from each of these <code><code>cmdb_rel_ci</code></code> records to create a new list of sys_ids</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">@childKeys</span> <span class="operator">=</span> <span class="keyword">map</span> <span class="operator">{</span> <span class="variable">$_</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">child</span><span class="operator">}</span> <span class="operator">}</span> <span class="variable">@relData</span><span class="operator">;</span>
</code></code></pre>

<p><code><code>@childKeys</code></code> now contains a lists of sys_ids for configuration items. We convert this list of keys into a query object and fetch athe records from the <code><code>cmdb_ci</code></code> table. If there are more than 200 records, <code><code>fetchAll</code></code> will loop internally until all records have been retrieved.</p>

<pre><code><code>    <span class="variable">@childRecs</span> <span class="operator">=</span> <span class="variable">$cmdb_ci</span><span class="operator">-&gt;</span><span class="variable">asQuery</span><span class="operator">(</span><span class="variable">@childKeys</span><span class="operator">)-&gt;</span><span class="variable">fetchAll</span><span class="operator">();</span>
    <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$childRec</span> <span class="operator">(</span><span class="variable">@childRecs</span><span class="operator">)</span> <span class="operator">{</span>
        <span class="keyword">print</span> <span class="variable">$childRec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">name</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>            
    <span class="operator">}</span>
</code></code></pre>

<h2 id="fetch">fetch</h2>

<h3 id="Description21">Description</h3>

<p>Fetch the next chunk of records from a table. This function calls <a href="#getRecords">&quot;getRecords&quot;</a> to retrieve the records. An optional parameter allows specification of the number of records to be retrieved. If not specified, then the number of records will be based on the default chunk size for this Query object. If there are no remaining records, then an empty list will be returned.</p>

<h3 id="Syntax19">Syntax</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$query</span><span class="operator">-&gt;</span><span class="variable">fetch</span><span class="operator">();</span>
    <span class="keyword">my</span> <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$query</span><span class="operator">-&gt;</span><span class="variable">fetch</span><span class="operator">(</span><span class="variable">$numrecs</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example10">Example</h3>

<p>This example prints the names of all active users. Each call to <a href="#getRecords">&quot;getRecords&quot;</a> returns up to 100 users.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">$query</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sys_user"</span><span class="operator">)-&gt;</span><span class="variable">query</span><span class="operator">(</span><span class="string">active</span> <span class="operator">=&gt;</span> <span class="string">"true"</span><span class="operator">,</span> <span class="string">__order_by</span> <span class="operator">=&gt;</span> <span class="string">"name"</span><span class="operator">);</span>
    <span class="keyword">while</span> <span class="operator">(</span><span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$query</span><span class="operator">-&gt;</span><span class="variable">fetch</span><span class="operator">(</span><span class="number">100</span><span class="operator">))</span> <span class="operator">{</span>
        <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">(</span><span class="variable">@recs</span><span class="operator">)</span> <span class="operator">{</span>
            <span class="keyword">print</span> <span class="variable">$rec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">name</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
        <span class="operator">}</span>
    <span class="operator">}</span>
</code></code></pre>

<h2 id="fetchAll">fetchAll</h2>

<h3 id="Description22">Description</h3>

<p>Fetch all the records in a Query by calling <a href="#fetch">fetch</a> repeatedly until there are no more records.</p>

<h3 id="Syntax20">Syntax</h3>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$query</span><span class="operator">-&gt;</span><span class="variable">fetchAll</span><span class="operator">();</span>
    <span class="keyword">my</span> <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$query</span><span class="operator">-&gt;</span><span class="variable">fetchAll</span><span class="operator">(</span><span class="variable">$chunkSize</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example11">Example</h3>

<p>This example prints the names of all active users. Each call to <a href="#getRecords">getRecords</a> returns up to 200 users since no chunk size was specified and the default is 200.</p>

<pre><code><code>    <span class="keyword">my</span> <span class="variable">@recs</span> <span class="operator">=</span> <span class="variable">$sn</span><span class="operator">-&gt;</span><span class="variable">table</span><span class="operator">(</span><span class="string">"sys_user"</span><span class="operator">)-&gt;</span><span class="variable">query</span><span class="operator">(</span><span class="string">active</span> <span class="operator">=&gt;</span> <span class="string">"true"</span><span class="operator">,</span> <span class="string">__order_by</span> <span class="operator">=&gt;</span> <span class="string">"name"</span><span class="operator">)-&gt;</span><span class="variable">fetchAll</span><span class="operator">();</span>
    <span class="keyword">foreach</span> <span class="keyword">my</span> <span class="variable">$rec</span> <span class="operator">(</span><span class="variable">@recs</span><span class="operator">)</span> <span class="operator">{</span>
         <span class="keyword">print</span> <span class="variable">$rec</span><span class="operator">-&gt;</span><span class="operator">{</span><span class="string">name</span><span class="operator">}</span><span class="operator">,</span> <span class="string">"\n"</span><span class="operator">;</span>
    <span class="operator">}</span>
</code></code></pre>

<h2 id="setColumns">setColumns</h2>

<h3 id="Description23">Description</h3>

<p>Restricts the list of columns that will be returned.</p>

<p>For some reason the Direct Web Services API allows you to specify a list of columns to be excluded from the query result, but there is no similar capability to specify a list of columns to be included. This function implements the more obviously needed behavior by inverting the list. It uses the WSDL to generate a list of columns returned by &lt;/getRecords&gt;, and subtracts the specified names to create an <code><code>&quot;__exclude_columns&quot;</code></code> extended query parameter.</p>

<p>By restricting the results to the needed columns, it is possible to significantly reduce the time required for large queries.</p>

<h3 id="Syntax21">Syntax</h3>

<pre><code><code>    <span class="variable">$query</span><span class="operator">-&gt;</span><span class="variable">setColumns</span><span class="operator">(</span><span class="variable">@list_of_columns</span><span class="operator">);</span>
    <span class="variable">$query</span><span class="operator">-&gt;</span><span class="variable">setColumns</span><span class="operator">(</span><span class="variable">$comma_delimited_list_of_columns</span><span class="operator">);</span>
</code></code></pre>

<h3 id="Example12">Example</h3>

<h1 id="AUTHOR">AUTHOR</h1>

<p>Giles Lewis</p>

<h1 id="ACKNOWLEDGEMENTS">ACKNOWLEDGEMENTS</h1>

<h1 id="LICENSE">LICENSE</h1>

<p>This program is free software; you can redistribute it and/or modify it under the terms of the the Artistic License (2.0). You may obtain a copy of the full license at:</p>

<p><a href="http://www.perlfoundation.org/artistic_license_2_0">http://www.perlfoundation.org/artistic_license_2_0</a></p>

<p>Any use, modification, and distribution of the Standard or Modified Versions is governed by this Artistic License. By using, modifying or distributing the Package, you accept this license. Do not use, modify, or distribute the Package, if you do not accept this license.</p>

<p>If your Modified Version has been derived from a Modified Version made by someone other than you, you are nevertheless required to ensure that your Modified Version complies with the requirements of this license.</p>

<p>This license does not grant you the right to use any trademark, service mark, tradename, or logo of the Copyright Holder.</p>

<p>This license includes the non-exclusive, worldwide, free-of-charge patent license to make, have made, use, offer to sell, sell, import and otherwise transfer the Package with respect to any patent claims licensable by the Copyright Holder that are necessarily infringed by the Package. If you institute patent litigation (including a cross-claim or counterclaim) against any party alleging that the Package constitutes direct or contributory patent infringement, then this Artistic License to you shall terminate on the date that such litigation is filed.</p>

<p>Disclaimer of Warranty: THE PACKAGE IS PROVIDED BY THE COPYRIGHT HOLDER AND CONTRIBUTORS &quot;AS IS&#39; AND WITHOUT ANY EXPRESS OR IMPLIED WARRANTIES. THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE, OR NON-INFRINGEMENT ARE DISCLAIMED TO THE EXTENT PERMITTED BY YOUR LOCAL LAW. UNLESS REQUIRED BY LAW, NO COPYRIGHT HOLDER OR CONTRIBUTOR WILL BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, OR CONSEQUENTIAL DAMAGES ARISING IN ANY WAY OUT OF THE USE OF THE PACKAGE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>

<h1 id="POD-ERRORS">POD ERRORS</h1>

<p>Hey! <b>The above document had some coding errors, which are explained below:</b></p>

<dl>

<dt id="Around-line-129:">Around line 129:</dt>
<dd>

<p>&#39;=item&#39; outside of any &#39;=over&#39;</p>

</dd>
<dt id="Around-line-181:">Around line 181:</dt>
<dd>

<p>You forgot a &#39;=back&#39; before &#39;=head1&#39;</p>

</dd>
</dl>


</body>

</html>


